---
title: "Accountable Care Organizations"
output: 
  flexdashboard::flex_dashboard:
    theme: paper
runtime: shiny
---

```{r global, include=FALSE}
# load data in 'global' chunk so it can be shared by all users of the dashboard

library(tidyverse)
library(ggplot2)
library(flexdashboard)
library(usmap)

aco <- readRDS("clean_data/aco.RDS")
county <- readRDS("clean_data/county.RDS")

acos <- readRDS("clean_data/acos_regression.RDS")
patient <- readRDS("clean_data/patient_regression.RDS")
provider <- readRDS("clean_data/provider_regression.RDS")

```

Intro  {data-orientation=rows}
===================================== 
    
Value Box Rows
------------------------------------------------

### Total Number of Participating ACOs in 2018

```{r value_totalaco}
num_acos <- length(unique(aco$ACO_ID))
valueBox(num_acos, icon = "fa-hashtag")
```

### Number of New ACOs

```{r value_newaco}
num_new <- aco %>%
  filter(Initial_Start_Year == 2018) %>%
  nrow()

valueBox(num_new, icon = "fa-user-plus")
```

### Total Number of Participating Providers 

```{r value_numproviders}
num_providers <- sum(aco$N_total_providers)
valueBox(prettyNum(num_providers, big.mark = ","), 
         icon = "fa-user-md")
```

### Total Number of Medicare Beneficiaries 

```{r value_numbeneficiaries}
num_beneficiaries <- sum(aco$N_AB)
valueBox(prettyNum(num_beneficiaries, big.mark = ","), 
         icon = "fa-user-friends")
```




Description Row {.tabset .tabset-fade}
------------------------------------------------

### What are Accountable Care Organizations?

#### Origins

In 2008, Dr. Elliot Fisher introduced the concept of an "Accountable Care Organization" during a meeting with the Medicare Payment Advisory Committee ([MedPAC](http://www.medpac.gov/)) in reference to a new **payment arrangement** where all providers share accountability for the continuum a patient's care. 

An Accountable Care Organization is a groups of doctors, hospitals, and other health care providers who agree to be paid under a reimbursement system that aims to incentivize **high-quality coordinated care** for Medicare Patients. 

#### Video 

Kaiser Health News has a 3-minute informative introduction to ACOs: 

<p align="center"><iframe src='https://players.brightcove.net/1875348214/Sy7mrdF0_default/index.html?videoId=4441613712001&cms:wordpress:5.4:1.6.1:iframe' allowfullscreen frameborder=0; width=600px; height = 500px></iframe></p>




### Why ACOs? {data-commentary-width=100}

#### The Problem

There are two main problems facing the US health care system. 

1. **Cost**: We spend *significantly* more on healthcare than all other countries
2. **Quality**: And yet, we've seen a decline in life expectancy for the past 3 years

Medicare traditionally paid providers and hospitals through a **Fee For Service** (FFS) payment system. That is, payments are made to providers and hospitals for each service provided.

This creates an incentive to prioritize the *quantity* of services over the *quality* of services. As a result, we see duplicative services and poor coordination of care for patients, which ultimately lead to poor outcomes.




### How do they work?

The following is a very pared down version of how ACOs

#### ACOs are responsible for:

- declaring which financial Track they would like to pursue.
  - ACOs in **Track 1** participate in one-sided risk (shared savings only)
  - ACOs in **Tracks 1+, 2, and 3** participate in two-sided risk (shared savings and shared losses).
- Providers see patients and send **claims** and bill CMS as they usually would Medicare beneficiaries
- Providing data on **quality measurements** to ensure they are eligible to share in any earned savings and avoid shared losses at the maximum level

#### CMS is reponsible for:

- assigning **beneficiaries** to the ACO by attributing beneficiaries to the providers from whom they receive the majority of their care.
- determine a **benchmark** based on prior expenditures, which sets a target for ACOs to limit their spending
- determining the **Minimum Loss Ratio** (MLR) / **Minimum Savings Ratio** (MSR) depending on the declared financial Track.
- processing **claims** data to determine total expenditures
- reconciling the difference between expenditures and the benchmark to determine whether or not savings or losses were incurred.

> For more information, you can read about the full process from CMS's [MSSP Methodology](https://www.cms.gov/Medicare/Medicare-Fee-for-Service-Payment/sharedsavingsprogram/Downloads/Shared-Savings-Losses-Assignment-Spec-V7.pdf)




Results 
=====================================     

Inputs {.sidebar}
-------------------------------------

Use the filters to see the results of how ACOs fared in 2018.

```{r}
selectInput(inputId = "agree",
            label = "Agreement Type",
            choices = aco$Agree_Type,
            multiple = TRUE,
            selected = unique(aco$Agree_Type))

selectInput(inputId = "current",
            label = "Current Track",
            choices = aco$current,
            multiple = TRUE,
            selected = unique(aco$current))

selectInput(inputId = "initial",
            label = "Initial Starting Year",
            choices = aco$Initial_Start_Year,
            multiple = TRUE,
            selected = unique(aco$Initial_Start_Year))

selectInput(inputId = "num_states",
            label = "Number of States",
            choices = aco$num_states,
            multiple = TRUE,
            selected = unique(aco$num_states))
```


Column
-------------------------------------

### RESULTS

There are 3 variables we can examine to look at performance results of ACOs in 2018.

- Categories for Generated Savings / Losses (Categorical)
- Benchmark minus Expenditures (Continuous - absolute measure)
- Savings Rate (Continuous - relative measure)



### Categories for Generated  Savings / Losses




```{r}
renderPlot({
  aco %>%
    filter(
      Agree_Type %in% input$agree,
      current %in% input$current,
      Initial_Start_Year %in% input$initial,
      num_states %in% input$num_states
    ) %>%
    count(GenSaveLoss_categorical) %>%
    ggplot(aes(x = GenSaveLoss_categorical, y = n)) +
    geom_col(aes(fill = GenSaveLoss_categorical)) +
    geom_text(aes(y = n + 10, label = n)) +
    theme_minimal() +
    labs(title = "Counts of Generated Savings / Losses Categories",
         y = "Count") +
    theme(
      panel.grid = element_blank(),
      legend.position = "none",
      axis.title = element_blank(),
      axis.text.y = element_blank()
    )
})
```


Column
-------------------------------------
    
    
### Benchmark Minus Expenditures


```{r}
renderPlot({
  aco %>%
    filter(
      Agree_Type %in% input$agree,
      current %in% input$current,
      Initial_Start_Year %in% input$initial,
      num_states %in% input$num_states
    ) %>%
    ggplot(aes(x = BnchmkMinExp)) +
    geom_density(aes(fill = GenSaveLoss_categorical), alpha = 0.4) +
    geom_density(linetype = "dotted") +
    theme_minimal() +
    labs(
      title = "Amount Generated (Savings / Losses)",
      x = "$ Amount",
      y = "Density",
      fill = "Category"
    ) +
    theme(panel.grid = element_blank())
})
```

> **Benchmark** (total amount allotted for all beneficiaries)  minus the **Expenditure** (total amount submitted in claims)

### Savings Rate

**Savings Rate** = Benchmark - Expenditure / Benchmark 


```{r}
renderPlot({
  aco %>%
    filter(
      Agree_Type %in% input$agree,
      current %in% input$current,
      Initial_Start_Year %in% input$initial,
      num_states %in% input$num_states
    ) %>%
    ggplot(aes(x = Sav_rate)) +
    geom_density(aes(fill = GenSaveLoss_categorical), alpha = 0.4) +
    geom_density(linetype = "dotted") +
    theme_minimal() +
    labs(
      title = "Savings Rate Distribution",
      x = "Savings Rate",
      y = "Density",
      fill = "Category"
    ) +
    theme(panel.grid = element_blank())
})
```

> This metric shows the relative size of the gains or losses, normalized by the benchmark amount. 

Regression {data-navmenu="Models"}
=====================================   


Regression {.sidebar}
-------------------------------------

Here we examine the effects of Patient, Provider, and ACO factors (explanatory variables) on the **Savings Rate** (outcome variable) using a multi-variate linear regression. The results of the 100 simulations of the regression are plotted. Each row represents the estimate with error bars produced by a single simulation.

*Dropdowns only work on corresponding panels*


```{r}
selectInput(inputId = "patient_term",
            label = "Patient Factors",
            choices = patient$term,
            selected = unique(patient$term)[1])

selectInput(inputId = "provider_term",
            label = "Provider Factors",
            choices = provider$term,
            selected = unique(provider$term)[1])

selectInput(inputId = "aco_term",
            label = "ACO Factors",
            choices = acos$term,
            selected = "Intercept") 
```



Regression {.tabset}
-------------------------------------

### Patient

```{r}
renderPlot({
  
  mean <- patient %>% filter(term == input$patient_term) %>%
    pull(estimate) %>%
    mean()
  
  patient %>%
    filter(term == input$patient_term) %>%
    ggplot(aes(x = reorder(replicate,-estimate))) +
    geom_point(aes(y = estimate, color = estimate > 0)) +
    geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
    geom_hline(yintercept = mean) +
    coord_flip() +
    theme_minimal() +
    theme(
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      panel.grid.major.y = element_blank()
    ) +
  labs(
    x = "Savings Rate Estimate",
    y = "Simulations",
    subtitle = "Results of 100 Simulations",
    title = paste("Mean of Estimates of ", input$patient_term, "is ", round(mean, 3))
  )
})
```


> **Intercept**: The average savings rate when all other variables are equal to 0. Defaults are: All beneficiaries are 0-64 and female.
  **% Beneficiaries Age 65-74** : The average change in Savings Rate with a 1% increase in the percentage of Beneficiaries between ages 65-74, holding all other variables constant.
  **% Beneficiaries Age 75-84** : The average change in Savings Rate with a 1% increase in the percentage of Beneficiaries between ages 75-84, holding all other variables constant.
  **% Beneficiaries Age 85+** : The average change in Savings Rate with a 1% increase in the percentage of Beneficiaries age 85 and older, holding all other variables constant.
  **% Specialist Providers** : The average change in Savings Rate with a 1% increase in the percentage of Specialist Providers, holding all other variables constant.

### Providers

```{r}
renderPlot({
  
  # patient %>% head()
  
  mean <- provider %>% filter(term == input$provider_term) %>%
    pull(estimate) %>%
    mean()
  
  provider %>%
    filter(term == input$provider_term) %>%
    ggplot(aes(x = reorder(replicate,-estimate))) +
    geom_point(aes(y = estimate, color = estimate > 0)) +
    geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
    geom_hline(yintercept = mean) +
    coord_flip() +
    theme_minimal() +
    theme(
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      panel.grid.major.y = element_blank()
    ) +
  labs(
    x = "Savings Rate Estimate",
    y = "Simulations",
    subtitle = "Results of 100 Simulations of Linear Regression",
    title = paste("Mean of Estimates of ", input$provider_term, "is ", round(mean, 3))
  )
})
```

> **Intercept**: The average savings rate when all other variables are equal to 0. Defaults are: 0%     PCPs, 0% Specialists, 0 Providers. This value does not have a meaningful interpretation in this   context.
  **% PCP Providers** : The average change in Savings Rate with a 1% increase in the number of PCP Providers, holding all other variables constant.
  **% Specialist Providers**: The average change in Savings Rate with a 1% increase in the number of Specialist Providers, holding all other variables constant.
  **Number of Total Providers**: The average change in Savings Rate when the number of any type of providers increases by 100, holding all other variables constant.



### ACO

```{r}
renderPlot({
  
  # patient %>% head()
  
  mean <- acos %>% filter(term == input$aco_term) %>%
    pull(estimate) %>%
    mean()
  
  acos %>%
    filter(term == input$aco_term) %>%
    ggplot(aes(x = reorder(replicate,-estimate))) +
    geom_point(aes(y = estimate, color = estimate > 0)) +
    geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
    geom_hline(yintercept = mean) +
    coord_flip() +
    theme_minimal() +
    theme(
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      panel.grid.major.y = element_blank()
    ) +
  labs(
    x = "Savings Rate Estimate",
    y = "Simulations",
    subtitle = "Results of 100 Simulations",
    title = paste("Mean of Estimates of ", input$aco_term, "is ", round(mean, 3))
  )
})
```

> **Intercept**: The average savings rate when all other variables are equal to 0. Defaults are: Initial Starting Year in 2012, ratio of Assigned Beneficiaries to Providers is 0, ACO in Track 1, Quality Score is 0.
  **Initial Starting Year**: The average change in Savings Rate in the selected starting year compared to the 2012, holding all other variables constant.
  **Ratio of Assigned Beneficiaries to Providers**: The average change in Savings Rate when the ratio of increased by 1 unit, holding all other variables constant.
  **Track**: The average change in Savings Rate for ACOs in selected track compared to Track 1, holding all other variables constant.
  **Quality Score**: The average change in Savings Rate when the Quality Score increases by 1%, holding all other variables constant.





Classification {data-navmenu="Models"}
=====================================   

Classification {.sidebar}
-------------------------------------

Classification!

Classification {.tabset}
-------------------------------------



Country {data-navmenu="Maps"}
=====================================   


Input {.sidebar}
-------------------------------------



```{r}
selectInput(inputId = "beneficiary_2",
            label = "Beneficiary Type",
            choices = county$Beneficiary)
```

* **End Stage Renal Disease** may be under 65, provision created by Social Security Act 
* **Disabled** may be under 65 with qualifying disabilities
* **Aged Dual** are 65 and older and are enrolled in both Medicaid and Medicare
* **Aged Non Dual** are 65 and older and only enrolled in Medicare


Output {.tabset}
-------------------------------------

### Person Years

Person Years are a more precise way of measuring the amount of people in Medicare provides services to each year by counting people proportional to the time they are in the Medicare program. For example, someone who turns 65 in March would contribute 3/4ths of a person-year.

```{r map_personyear}

renderPlot({
  c <- county %>% 
    filter(Beneficiary == input$beneficiary_2,
           Category == "Person Years")
  
  plot_usmap(data = c,
             regions = "counties",
             values = "Values",
             color = "white",
             selected = "Aged Non-Dual") +
    scale_fill_continuous(low = "#DFF0EA", high = "#2A7886") +
    theme(legend.position = "bottom",
          legend.direction = "horizontal")
  
})

```

> Data is aggregated at a county level. This map is meant to show a distribution of patient characteristics nationwide by county.


### Risk Adjustment 

Risk Adjustment Factors are calculated to modify patients for higher degrees of illness, based on patient demographics and Hierarchical Condition Categories (HCC). Risk adjustment scores are normalized around 1.0, and range from around 0.9 to 1.7. These are then multiplied to a dollar amount to set the expected expenditure and capitation for that individual. 

```{r map_riskadjust}

renderPlot({
  c <- county %>% 
    filter(Beneficiary == input$beneficiary_2,
           Category == "Average HCC Risk Score")
  
  plot_usmap(data = c,
             regions = "counties",
             values = "Values",
             color = "white",
             selected = "Aged Non-Dual") +
    scale_fill_continuous(low = "#DFF0EA", high = "#2A7886") +
    theme(legend.position = "bottom",
          legend.direction = "horizontal")
  
})

```



### Per Capita Expenditures



```{r map_expenditure}

renderPlot({
  c <- county %>% 
    filter(Beneficiary == input$beneficiary_2,
           Category == "Per Capita Expenditures")
  
  plot_usmap(data = c,
             regions = "counties",
             values = "Values",
             color = "white",
             selected = "Aged Non-Dual") +
    scale_fill_continuous(low = "#DFF0EA", high = "#2A7886") +
    theme(legend.position = "bottom",
          legend.direction = "horizontal")
  
})

```


Summary {data-width=250}
-------------------------------------

### Beneficiary Summary

```{r}

renderPlot({
  county %>%
    group_by(Beneficiary, Category) %>%
    summarize(Values = mean(Values, na.rm = TRUE)) %>%
    filter(Category == "Per Capita Expenditures") %>%
    # filter(Category == input$category_2) %>%
    ggplot(aes(x = Beneficiary, y = Values)) +
    geom_col(aes(width = 0.7)) + 
    scale_y_continuous(labels = scales::comma) +
    coord_flip() + 
    theme_minimal() +
    theme(
      axis.title = element_blank()
    )
})
```

### Person Year 

```{r value_personyear}

```


### Average HCC Risk Score 

```{r value_riskscore}

```


### Per Capita Expenditure

```{r value_expenditure}

```



States {data-navmenu="Maps"}
=====================================   


Input {.sidebar}
-------------------------------------

```{r}
selectInput(inputId = "state",
            label = "State",
            choices = county$state_name)
```

```{r}
selectInput(inputId = "beneficiary",
            label = "Beneficiary Type",
            choices = county$Beneficiary)
```

* **End Stage Renal Disease** may be under 65, provision created by Social Security Act 
* **Disabled** may be under 65 with qualifying disabilities
* **Aged Dual** are 65 and older and are enrolled in both Medicaid and Medicare
* **Aged Non Dual** are 65 and older and only enrolled in Medicare

```{r}
selectInput(inputId = "category",
            label = "Category",
            choices = county$Category)
```


Output 
-------------------------------------

### State Maps

```{r}
renderPlot({
  d <- county %>%
    filter(Beneficiary == input$beneficiary,
           Category == input$category) 
  
  plot_usmap(data = d,
             regions = "counties",
             include = input$state,
             values = "Values",
             color = "white") +
    scale_fill_continuous(low = "#DFF0EA", high = "#2A7886") +
    theme(legend.position = "bottom",
          legend.direction = "horizontal") + 
    labs(
      title = paste(input$beneficiary, "Beneficiaries in ", input$state),
      subtitle = paste("by ", input$category),
      fill = paste("Count of ", input$category)
    )
})
```

> Data is aggregated at a county level. This map is meant to show a distribution of patient characteristics in each state by county.

Summary {data-width=250}
-------------------------------------

### Beneficiary Summary

```{r}

renderPlot({
  county %>%
    group_by(Beneficiary, Category, State) %>%
    summarize(Values = sum(Values)) %>%
    filter(Category == input$category,
           State == input$state) %>%
    ggplot(aes(x = Beneficiary, y = Values)) +
    geom_col() + 
    scale_y_continuous(labels = scales::comma) +
    coord_flip() + 
    theme_minimal() +
    theme(
      axis.title = element_blank()
    )
})
```

### Category Summary

```{r}
renderPlot({
county %>%
  group_by(Beneficiary, Category, State) %>%
  summarize(Values = sum(Values)) %>%
  filter(Beneficiary == input$beneficiary,
         State == input$state) %>%
  ggplot(aes(x = Category, y = Values)) +
  geom_col() + 
  scale_y_continuous(labels = scales::comma) +
  coord_flip() + 
  theme_minimal() +
  theme(
    axis.title = element_blank()
  )})
```

About 
===================================== 



Data Sources {data-width=750}
-------------------------------------

### Data Sources

#### ACO Data

2018 Shared Savings Program (SSP) 
Accountable Care Organizations (ACO)
Public Use File 

To address the increasing number of requests for SSP ACO data, the Centers for Medicare (CM) has created a standard analytical file that CMS can use to efficiently satisfy these requests. It is the intent of CM to publish the ACO-level public-use file (PUF) that contains ACO-specific metrics as well as summarized beneficiary and provider information for each performance year of the SSP program.

https://data.cms.gov/Special-Programs-Initiatives-Medicare-Shared-Savin/2018-Shared-Savings-Program-SSP-Accountable-Care-O/v47u-yq84

#### Beneficiaries by County Data 

Aggregate data consisting of per capita Parts A and B FFS expenditures, average CMS-HCC prospective risk scores and total person-years for assignable beneficiaries by Medicare enrollment type (End Stage Renal Disease (ESRD), disabled, aged/dual eligible, aged/non-dual eligible). It is the intent of CM to publish this PUF annually, in the summer following the conclusion of the calendar year to which it relates.

https://data.cms.gov/Special-Programs-Initiatives-Medicare-Shared-Savin/2018-County-level-FFS-Data-for-Shared-Savings-Prog/sju4-8k6c"


> Source code for this project is available on Github [here](https://github.com/karenmjiang/MSSP-ACO-2018).

About
-------------------------------------

### About Me

#### My name is Karen Jiang 

I am MPH Candidate in Health Policy with a Decision Science interest at the [**Harvard T. H. Chan School of Public Health**](https://www.hsph.harvard.edu/). I am interested in using data visualization and communication as an advocacy tool to bring to light health disparities and help people make better decisions about health policy.

### Contact Info

#### Connect with me via...

`r icon::fa("envelope")` Email:

* karenjiang@hsph.harvard.edu
* karenmjiang@gmail.com

`r icon::fa("linkedin-in")` LinkedIn:

* [linkedin.com/in/karenmjiang](https://www.linkedin.com/in/karenmjiang/)

`r icon::fa("github")` Github:

* [github.com/karenmjiang](https://github.com/karenmjiang)


